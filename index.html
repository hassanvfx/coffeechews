<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>YouChews – CoffeeChews</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;900&display=swap" rel="stylesheet">

  <style>
    /* ---------- BASE ---------- */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; overflow-x: hidden; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      background: #fffaf3;
      color: #1c130d;
      -webkit-text-size-adjust: 100%;
    }
    :root{
      --muted: #6f5c50;
      --accent: #7b4b2a;
      --accent-2: #e8d6c1;
      --pill: #2b1a10;
      --success: #1a8917;

      --card: #ffffff;
      --shadow: 0 6px 24px rgba(0,0,0,.08);
      --radius-xl: 18px;
      --radius-lg: 14px;

      --maxw: 980px;
      --side-pad: 16px;
    }
    @media (prefers-reduced-motion:no-preference){
      .smooth{ transition: all .22s ease; }
      .fade{ transition: opacity .25s ease; }
      .hover-rise:hover{ transform: translateY(-2px); }
    }

    .wrap{
      width: 100%;
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 16px var(--side-pad) 32px;
    }

    header.hero{
      display:grid; gap: 8px;
      align-items:center; justify-items:center; text-align:center;
      padding: 18px 0 8px;
    }
    .brand{ display:flex; gap:10px; align-items:center; font-weight:900; letter-spacing:.5px; }
    .brand-logo{
      width:36px; height:36px; border-radius:10px;
      background: linear-gradient(135deg, #7b4b2a, #c08952);
      box-shadow: var(--shadow);
      flex: 0 0 auto;
    }
    .title{ font-size: clamp(22px, 6vw, 36px); line-height:1.05; font-weight:900; }
    .subtitle{ font-size: 14px; color: var(--muted); }

    /* ---------- MASONRY GRID (2 columns) ---------- */
    .masonry{
      column-count: 2;
      column-gap: 14px;
    }
    @media (max-width: 640px){ .masonry{ column-count: 2; } }
    @media (max-width: 460px){ .masonry{ column-count: 1; } }

    .plan-card{
      break-inside: avoid;
      background: var(--card);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow);
      display: block;
      margin: 0 0 16px;
      overflow: hidden;
      border: 1px solid #efdfcb;
    }

    /* Featured look (default 30 chews) */
    .plan-card.featured{
      background: #2b1a10;
      color: #fff;
      border: 1px solid #2b1a10;
      box-shadow: 0 18px 40px rgba(43,26,16,.25);
      position: relative;
      isolation: isolate;
    }
    .plan-card.featured::before{
      content:"Most Popular";
      position:absolute; top:10px; left:10px;
      z-index:2;
      font-size: 11px; font-weight: 900; letter-spacing:.3px;
      background: #ffd6a3;
      color:#2b1a10;
      padding:6px 10px; border-radius:999px;
      box-shadow: 0 6px 16px rgba(0,0,0,.2);
    }

    /* Visual area */
    .img-wrap{
      position: relative;
      width: 100%;
      background: #f3ece5;
      border-bottom: 1px solid var(--accent-2);
      display:grid; place-items:center;
      overflow: hidden;
      padding: 10px;
    }
    .plan-card.featured .img-wrap{ background: #392417; border-bottom-color:#3f2a1a; }
    .plan-card img{
      width: 100%; height: auto; display:block; object-fit: contain;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.12));
      opacity: .999;
      border-radius: 12px;
    }

    /* Savings overlay */
    .save-overlay{
      position: absolute; top: 10px; right: 10px;
      display: inline-flex; flex-direction: column; align-items: flex-end; gap: 4px;
      background: linear-gradient(135deg, rgba(26,137,23,.92), rgba(26,137,23,.78));
      color: #fff; border-radius: 12px; padding: 10px 12px;
      box-shadow: 0 10px 26px rgba(0,0,0,.25);
      backdrop-filter: blur(6px);
      pointer-events: none;
      z-index: 2;
      transform-origin: top right;
    }
    .save-overlay .big{ font-size: clamp(15px, 3.8vw, 22px); font-weight: 900; line-height: 1.05; white-space: nowrap; }
    .save-overlay .sub{ font-size: 12px; opacity:.95; }

    /* Content area */
    .plan-body{ padding: 14px 14px 6px; }
    .plan-head{
      display:flex; align-items:baseline; justify-content:space-between; gap:10px; margin-bottom: 8px;
    }
    .plan-title{ font-weight: 900; font-size: 18px; line-height: 1.1; }
    .plan-price{ font-weight: 900; font-size: 18px; }
    .plan-sub{ color: var(--muted); font-size: 13px; }
    .plan-card.featured .plan-sub{ color: #e8dcca; }

    /* Cups block (mini) */
    .cups-block{
      background: #fff8ee;
      border:1px dashed #e9d6bd;
      border-radius: 12px;
      padding: 10px;
      display:grid; gap:8px;
      width: 100%;
    }
    .plan-card.featured .cups-block{
      background:#3a2a1f; border-color:#5a3d2b;
    }
    .cups-grid{
      display:grid;
      grid-template-columns: repeat(12, minmax(12px, 1fr));
      gap: 4px;
      justify-items:center; width:100%;
    }
    .cup{ font-size: 1.5rem; line-height:1; }
    .cup.muted{ opacity:.4; }
    .cups-summary{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center;
      font-weight:800;
      color: var(--pill);
    }
    .plan-card.featured .cups-summary{ color:#fff; }
    .badge{
      background:#fff; border:1px solid #e7d8c5; padding:6px 10px; border-radius:999px; font-size: 12px;
    }
    .plan-card.featured .badge{
      background:#2b1a10; border-color:#5a3d2b; color:#fff;
    }

    .actions{ padding: 8px 14px 16px; }
    .btn{
      display:grid; place-items:center; width:100%;
      border-radius: 12px; padding: 14px;
      font-weight: 900; letter-spacing:.2px; text-decoration:none; user-select:none;
      border: none; cursor: pointer;
    }
    .btn-primary{
      background: linear-gradient(180deg, #2b1a10, #3b2415);
      color: #fff; box-shadow: 0 10px 26px rgba(43,26,16,.35);
      font-size: 16px;
    }
    .plan-card.featured .btn-primary{
      background: linear-gradient(180deg, #ffe0b8, #ffc98e);
      color:#2b1a10; box-shadow: 0 12px 30px rgba(255,201,142,.35);
    }

    /* tiny helpers */
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <div class="brand">
        <div id="brandText">YouChews</div>
      </div>
      <div class="title">Pick Your Saving Size</div>
      <div class="subtitle">1 Chew = 1☕️ Cup</div>
    </header>

    <!-- Masonry Grid of Plans -->
    <section class="masonry" id="planGrid" aria-label="Available plans"></section>
  </div>

  <script>
    const params = new URLSearchParams(location.search);

    const DEFAULTS = [
      { chews: 5,  price:  9.99, img: "assets/chews5.jpg",  amazon: "https://www.amazon.com/YouChews-Caffeine-Chew-Ingredients-Supplement/dp/B0CXVKQ79B?maas=maas_adg_B82922D0E892A1ABB0A49127FE1C7EC5_afap_abs&ref_=aa_maas&tag=maas&th=1", stock: 1 },
      { chews: 10, price: 14.99, img: "assets/chews10.jpg", amazon: "https://www.amazon.com/YouChews-Caffeine-Chew-Ingredients-Supplement/dp/B0CXVKQ79B?maas=maas_adg_50391CFB3CCE23F38F47FB37398B31C7_afap_abs&ref_=aa_maas&tag=maas&th=1", stock: 1 },
      { chews: 30, price: 29.99, img: "assets/chews30.jpg", amazon: "https://www.amazon.com/YouChews-Caffeine-Chew-Ingredients-Supplement/dp/B0CXVKQ79B?maas=maas_adg_0A01F090F37E839DA0308E98223BFE26_afap_abs&ref_=aa_maas&tag=maas&th=1", stock: 12 },
      { chews: 60, price: 49.99, img: "assets/chews60.jpg", amazon: "http://amazon.com/YouChews-Coffee-Chews-Caffeine-Ingredients/dp/B0CGSMNKZF?maas=maas_adg_DE10801AC9B210D2B47252508EA4EB93_afap_abs&ref_=aa_maas&tag=maas", stock: 6  },
    ];

    const products = DEFAULTS.map((p, i) => {
      const idx = i + 1;
      const pp = params.get("p" + idx);
      let chews = p.chews, price = p.price;
      if (pp) {
        const [c, pr] = pp.split("-");
        const cInt = parseInt(c, 10);
        const prF = parseFloat(pr);
        if (!Number.isNaN(cInt)) chews = cInt;
        if (!Number.isNaN(prF)) price = prF;
      }
      const img = params.get("img" + idx) || p.img;
      const amazon = params.get("a" + idx) || p.amazon;
      const s = params.get("s" + idx);
      const stock = s !== null ? Math.max(0, parseInt(s, 10) || 0) : p.stock;
      return { chews, price, img, amazon, stock };
    }).sort((a,b) => a.chews - b.chews);

    const brandTextEl = document.getElementById("brandText");
    const brandText = params.get("brand") || "CoffeeChews";
    brandTextEl.textContent = brandText;
    document.title = `${brandText} – CoffeeChews`;

    const COFFEE_PRICE = (() => {
      const c = parseFloat(params.get("coffee"));
      return Number.isFinite(c) && c > 0 ? c : 3.50;
    })();

    const DEFAULT_CHEWS = (() => {
      const d = parseInt(params.get("default_chews") || "30", 10);
      return Number.isFinite(d) && d > 0 ? d : 30;
    })();

    function currency(n){ return "$" + n.toFixed(2); }
    function plural(n, one, many){ return n === 1 ? one : many; }
    function perUnit(price, qty){ return qty > 0 ? price / qty : 0; }

    function computeSavings(p){
      const coffeeCost = COFFEE_PRICE * p.chews;
      const save = Math.max(0, coffeeCost - p.price);
      const pct = coffeeCost > 0 ? (save / coffeeCost) * 100 : 0;
      return { save, pct, coffeeCost };
    }

    function cupsGridHTML(chews){
      const MAX = 48; // mini grid cap per card
      const show = Math.min(MAX, chews);
      let html = "";
      for (let i = 0; i < show; i++) html += `<span class="cup">☕</span>`;
      if (chews > MAX) {
        html += `<span class="cup muted">…</span><span class="cup">+${chews - MAX}</span>`;
      }
      return html;
    }

    function buildCard(p){
      const { save, pct } = computeSavings(p);
      const featured = p.chews === DEFAULT_CHEWS;
      const oos = p.stock <= 0;

      return `
        <article class="plan-card smooth hover-rise ${featured ? "featured" : ""}" data-chews="${p.chews}">
          <div class="img-wrap">
            <div class="save-overlay smooth">
              <div class="big">You save ${currency(save)} (${pct.toFixed(0)}%)</div>
              <div class="sub">vs ${p.chews} ${plural(p.chews,"coffee","coffees")} @ ${currency(COFFEE_PRICE)}</div>
            </div>
            <img src="${p.img}" alt="${p.chews} CoffeeChews"/>
          </div>

          <div class="plan-body">
            <div class="plan-head">
              <div class="plan-title">${p.chews} ${plural(p.chews,"Chew","Chews")}</div>
              <div class="plan-price">${currency(p.price)}</div>
            </div>
            <div class="plan-sub">${currency(perUnit(p.price, p.chews))} per chew</div>

            <div class="cups-block" style="margin-top:10px;">
              <div class="cups-grid">${cupsGridHTML(p.chews)}</div>
              <div class="cups-summary" style="margin-top:6px;">
                <span class="badge">${p.chews} ${plural(p.chews,"cup","cups")} total</span>
                <span class="badge">@ ${currency(COFFEE_PRICE)} coffee</span>
              </div>
            </div>
          </div>

          <div class="actions">
            <a class="btn btn-primary ${oos ? "btn-disabled" : ""}" ${oos ? 'aria-disabled="true" tabindex="-1"' : `href="${p.amazon}"`}
               rel="noopener" target="_self">
               ${oos ? "Out of Stock" : "Choose →"}
            </a>
          </div>
        </article>
      `;
    }

    (function init(){
      const grid = document.getElementById("planGrid");
      grid.innerHTML = products.map(buildCard).join("");

      // Optional: click anywhere on card (except when OOS) to choose
      grid.addEventListener("click", (e) => {
        const a = e.target.closest("a.btn");
        if (a) return; // button already handles
        const card = e.target.closest(".plan-card");
        if (!card) return;
        const chews = parseInt(card.dataset.chews, 10);
        const p = products.find(x => x.chews === chews);
        if (!p || p.stock <= 0) return;
        window.location.href = p.amazon;
      });
    })();
  </script>
</body>
</html>
