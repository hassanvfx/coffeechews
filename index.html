<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>YouChews – CoffeeChews</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;900&display=swap" rel="stylesheet">

  <style>
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; overflow-x: hidden; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      background: #fffaf3;
      color: #1c130d;
      -webkit-text-size-adjust: 100%;
    }
    :root{
      --muted: #6f5c50;
      --accent: #7b4b2a;
      --accent-2: #e8d6c1;
      --pill: #2b1a10;
      --success: #1a8917;
      --card: #ffffff;
      --shadow: 0 6px 24px rgba(0,0,0,.08);
      --radius-xl: 18px;
      --radius-lg: 14px;
      --maxw: 980px;
      --side-pad: 16px;
    }
    @media (prefers-reduced-motion: no-preference){
      .smooth { transition: all .22s ease; }
      .fade { transition: opacity .25s ease; }
    }

    .wrap{
      width: 100%;
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 16px var(--side-pad) 40px;
    }

    header.hero{
      display:grid; gap: 6px;
      align-items:center; justify-items:center; text-align:center;
      padding: 18px 0 10px;
    }
    .brand{ font-weight:900; letter-spacing:.5px; }
    .title{
      font-size: clamp(22px, 5.5vw, 34px);
      line-height: 1.05;
      font-weight: 900;
      padding: 0 var(--side-pad);
    }
    .subtitle{
      font-size: 14px;
      color: var(--muted);
      padding: 0 var(--side-pad);
    }

    /* Masonry grid (CSS columns) */
    .plans{
      column-count: 1;
      column-gap: 16px;
    }
    @media (min-width: 600px){ .plans{ column-count: 2; } }

    .plan-card{
      display: inline-block;            /* needed inside column layout */
      width: 100%;
      background: var(--card);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow);
      padding: 14px;
      margin: 0 0 16px;
      break-inside: avoid;              /* prevent column breaks */
    }

    .product-visual{ display:grid; gap:10px; }
    .img-wrap{
      position: relative;
      width: 100%; aspect-ratio: 1/1;
      background: #f3ece5;
      border-radius: var(--radius-lg);
      display:grid; place-items:center;
      overflow: hidden;
      border: 1px solid var(--accent-2);
      padding: 10px;
      will-change: transform;
    }
    .product-visual img{
      width: 100%; height: auto; object-fit: contain;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.12));
      opacity: 0.999;
    }

    .save-overlay{
      position: absolute; top: 10px; right: 10px;
      display: inline-flex; flex-direction: column; gap: 4px;
      background: linear-gradient(135deg, rgba(26,137,23,.92), rgba(26,137,23,.78));
      color: #fff; border-radius: 12px; padding: 10px 12px;
      box-shadow: 0 10px 26px rgba(0,0,0,.25);
      backdrop-filter: blur(6px);
      pointer-events:none;
    }
    .save-overlay .big{ font-size: clamp(14px, 4.2vw, 22px); font-weight:900; line-height:1.05; }
    .save-overlay .sub{ font-size: 11px; opacity:.95; }

    .plan-head{
      display:flex; align-items:baseline; justify-content:space-between; gap:10px;
    }
    .plan-name{ font-weight:900; font-size: 18px; }
    .plan-price{ font-weight:900; font-size: 20px; }

    .meta{ display:flex; flex-wrap:wrap; gap:8px; color:var(--muted); font-size:13px; }
    .badge{
      background:#fff; border:1px solid #e7d8c5; padding:6px 10px; border-radius:999px;
      font-size: 12px; color:#2b1a10; font-weight:700;
    }

    .cups-block{
      background: #fff8ee;
      border:1px dashed #e9d6bd;
      border-radius: 14px;
      padding: 10px;
      display:grid; gap:8px;
      width: 100%;
    }
    .cups-grid{
      display:grid;
      --cols: 8;
      grid-template-columns: repeat(var(--cols), minmax(16px, 1fr));
      gap: 6px;
      justify-items:center; justify-content:center; place-content:center;
    }
    .cup{ font-size: 1.8rem; line-height:1; }
    .cup.muted{ opacity:.4; }
    .cups-summary{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center;
      font-weight:800; color: var(--pill);
    }

    .btn{
      display:inline-grid; place-items:center;
      border-radius: 12px; padding: 14px;
      font-weight: 900; letter-spacing:.2px; text-decoration:none; user-select:none;
      border: none; cursor: pointer; width: 100%;
    }
    .btn-primary{
      background: linear-gradient(180deg, #2b1a10, #3b2415);
      color: #fff;
      box-shadow: 0 10px 26px rgba(43,26,16,.35);
      font-size: 16px;
    }
    .btn-disabled{ background:#ccc; color:#666; box-shadow:none; cursor:not-allowed; }

    .default-chip{
      margin-left: 6px; font-size: 11px; padding: 2px 8px; border-radius:999px;
      background:#fff; border:1px solid #b68a63; color:#2b1a10; font-weight:800;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <div class="brand" id="brandText">YouChews</div>
      <div class="subtitle" id="equivalencyHeader">1 Chew = 1☕️ Cup </div>
    </header>

    <!-- Masonry grid -->
    <section class="plans" id="plansGrid"></section>
  </div>

  <script>
    const params = new URLSearchParams(location.search);

    const DEFAULTS = [
      { chews:  5, price:  9.99, img: "assets/chews5.jpg",  amazon: "https://www.amazon.com/YouChews-Caffeine-Chew-Ingredients-Supplement/dp/B0CXVKQ79B?maas=maas_adg_B82922D0E892A1ABB0A49127FE1C7EC5_afap_abs&ref_=aa_maas&tag=maas&th=1", stock: 1 },
      { chews: 10, price: 14.99, img: "assets/chews10.jpg", amazon: "https://www.amazon.com/YouChews-Caffeine-Chew-Ingredients-Supplement/dp/B0CXVKQ79B?maas=maas_adg_50391CFB3CCE23F38F47FB37398B31C7_afap_abs&ref_=aa_maas&tag=maas&th=1", stock: 1 },
      { chews: 30, price: 29.99, img: "assets/chews30.jpg", amazon: "https://www.amazon.com/YouChews-Caffeine-Chew-Ingredients-Supplement/dp/B0CXVKQ79B?maas=maas_adg_0A01F090F37E839DA0308E98223BFE26_afap_abs&ref_=aa_maas&tag=maas&th=1", stock: 12 },
      { chews: 60, price: 49.99, img: "assets/chews60.jpg", amazon: "http://amazon.com/YouChews-Coffee-Chews-Caffeine-Ingredients/dp/B0CGSMNKZF?maas=maas_adg_DE10801AC9B210D2B47252508EA4EB93_afap_abs&ref_=aa_maas&tag=maas", stock: 6  },
    ];

    const products = DEFAULTS.map((p, i) => {
      const idx = i + 1;
      const pp = params.get("p" + idx);
      let chews = p.chews, price = p.price;
      if (pp) {
        const [c, pr] = pp.split("-");
        const cInt = parseInt(c, 10);
        const prF = parseFloat(pr);
        if (!Number.isNaN(cInt)) chews = cInt;
        if (!Number.isNaN(prF)) price = prF;
      }
      const img = params.get("img" + idx) || p.img;
      const amazon = params.get("a" + idx) || p.amazon;
      const s = params.get("s" + idx);
      const stock = s !== null ? Math.max(0, parseInt(s, 10) || 0) : p.stock;
      return { chews, price, img, amazon, stock };
    }).sort((a,b) => a.chews - b.chews);

    const brandTextEl = document.getElementById("brandText");
    const plansGrid   = document.getElementById("plansGrid");

    const brandText = params.get("brand") || "CoffeeChews";
    brandTextEl.textContent = brandText;
    document.title = `${brandText} – CoffeeChews`;

    const COFFEE_PRICE = (() => {
      const c = parseFloat(params.get("coffee"));
      return Number.isFinite(c) && c > 0 ? c : 3.50;
    })();

    // default selection badge (e.g., ?default_chews=30)
    const DEFAULT_CHEWS = (() => {
      const d = parseInt(params.get("default_chews") || "30", 10);
      return Number.isFinite(d) && d > 0 ? d : 30;
    })();

    function currency(n){ return "$" + n.toFixed(2); }
    function perUnit(price, qty){ return qty > 0 ? price / qty : 0; }
    function pluralize(n, one, many){ return n === 1 ? one : many; }

    function renderCupsGrid(container, chews){
      container.innerHTML = "";
      const MAX_ICONS = 60;
      const show = Math.min(MAX_ICONS, chews);
      for (let i = 0; i < show; i++){
        const s = document.createElement("span");
        s.className = "cup";
        s.textContent = "☕";
        container.appendChild(s);
      }
      if (chews > MAX_ICONS){
        const dots = document.createElement("span");
        dots.className = "cup muted";
        dots.textContent = "…";
        container.appendChild(dots);
        const more = document.createElement("span");
        more.className = "cup";
        more.textContent = `+${chews - MAX_ICONS}`;
        container.appendChild(more);
      }
    }

    function makePlanCard(p){
      const coffeeCost = COFFEE_PRICE * p.chews;
      const save = Math.max(0, coffeeCost - p.price);
      const pct = coffeeCost > 0 ? (save / coffeeCost) * 100 : 0;

      const card = document.createElement("article");
      card.className = "plan-card";

      card.innerHTML = `
        <div class="product-visual">
          <div class="img-wrap smooth">
            <div class="save-overlay">
              <div class="big">Save ${currency(save)} (${pct.toFixed(0)}%)</div>
              <div class="sub">vs buying coffees</div>
            </div>
            <img class="fade" alt="${p.chews} CoffeeChews" src="${p.img}">
          </div>
        </div>

        <div class="plan-head" style="margin-top:10px;">
          <div class="plan-name">${p.chews} ${pluralize(p.chews,"Chew","Chews")}
            ${p.chews === DEFAULT_CHEWS ? '<span class="default-chip">Default</span>' : ''}
          </div>
          <div class="plan-price">${currency(p.price)}</div>
        </div>

        <div class="meta" style="margin:8px 0 2px;">
          <span class="badge">${currency(perUnit(p.price, p.chews))} per chew</span>
          <span class="badge">@ ${currency(COFFEE_PRICE)} coffee</span>
          ${p.stock > 0 ? '' : '<span class="badge" style="border-color:#c77; color:#a11;">Out of stock</span>'}
        </div>

        <div class="cups-block" style="margin-top:8px;">
          <div class="subtitle">${p.chews} Chews = ${p.chews} ${pluralize(p.chews,"Cup","Cups")}</div>
          <div class="cups-grid"></div>
          <div class="cups-summary">
            <span class="badge">${p.chews} ${pluralize(p.chews,"cup","cups")} total</span>
          </div>
        </div>

        <button class="btn ${p.stock > 0 ? 'btn-primary' : 'btn-disabled'}" ${p.stock>0?'':'disabled'}>
          Pick ${p.chews} Chews →
        </button>
      `;

      // cups grid render
      const cupsGrid = card.querySelector(".cups-grid");
      renderCupsGrid(cupsGrid, p.chews);

      // button action
      const btn = card.querySelector("button");
      btn.addEventListener("click", () => {
        if (p.stock <= 0) return;
        const href = p.amazon || "";
        if (!href){ alert("No product page available."); return; }
        window.location.href = href;
      });

      return card;
    }

    (function init(){
      const frag = document.createDocumentFragment();
      products.forEach(p => frag.appendChild(makePlanCard(p)));
      plansGrid.appendChild(frag);

      // reflow cups on resize to keep columns tidy (optional)
      window.addEventListener("resize", () => {
        document.querySelectorAll(".plan-card").forEach(card => {
          const cupsGrid = card.querySelector(".cups-grid");
          const chews = parseInt(card.querySelector(".plan-name").textContent, 10);
          if (cupsGrid && Number.isFinite(chews)) renderCupsGrid(cupsGrid, chews);
        });
      });
    })();
  </script>
</body>
</html>
